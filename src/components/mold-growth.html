<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚«ãƒ“ã®æˆé•·ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Arial', sans-serif;
            color: #fff;
        }
        canvas {
            border: 2px solid #333;
            background: #f5f5dc;
            cursor: crosshair;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 10px 20px;
            font-size: 14px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button.danger {
            background: #f44336;
        }
        button.danger:hover {
            background: #da190b;
        }
        .info {
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            color: #aaa;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 14px;
            border-radius: 5px;
            border: 1px solid #555;
            background: #2a2a2a;
            color: white;
            width: 200px;
        }
        label {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <h1>ğŸ„ ã‚«ãƒ“ã®æˆé•·ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
    <canvas id="moldCanvas" width="800" height="600"></canvas>
    
    <div class="controls">
        <button id="startBtn">æˆé•·é–‹å§‹</button>
        <button id="pauseBtn">ä¸€æ™‚åœæ­¢</button>
        <button class="danger" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
        <label>
            <span>ä¿è­·ãƒ†ã‚­ã‚¹ãƒˆ:</span>
            <input type="text" id="textInput" value="SAFE ZONE" />
        </label>
        <button id="updateTextBtn">ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°</button>
    </div>
    
    <div class="info">
        <p>ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚«ãƒ“ã®èƒå­ã‚’è¿½åŠ ã§ãã¾ã™</p>
        <p>ã‚«ãƒ“ã¯æ–‡å­—ã®é ˜åŸŸã‚’é¿ã‘ã¦åºƒãŒã‚Šã¾ã™</p>
    </div>

    <script>
        const canvas = document.getElementById('moldCanvas');
        const ctx = canvas.getContext('2d');
        
        let isRunning = false;
        let moldCells = [];
        let textMask = [];
        let protectedText = 'SAFE ZONE';
        
        // ã‚«ãƒ“ã®è‰²ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
        const moldColors = [
            { r: 60, g: 100, b: 50 },   // æ¿ƒã„ç·‘
            { r: 80, g: 120, b: 60 },   // ç·‘
            { r: 100, g: 140, b: 70 },  // æ˜ã‚‹ã„ç·‘
            { r: 70, g: 90, b: 40 },    // ã‚ªãƒªãƒ¼ãƒ–
            { r: 50, g: 80, b: 60 },    // é’ç·‘
        ];
        
        class MoldCell {
            constructor(x, y, age = 0) {
                this.x = x;
                this.y = y;
                this.age = age;
                this.color = moldColors[Math.floor(Math.random() * moldColors.length)];
                this.spread = false;
            }
            
            draw() {
                const alpha = Math.min(0.3 + (this.age / 100) * 0.7, 1);
                ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${alpha})`;
                
                // ãµã‚ãµã‚ã—ãŸè³ªæ„Ÿã‚’å‡ºã™ãŸã‚ã«è¤‡æ•°ã®å††ã‚’æç”»
                const size = 2 + Math.random() * 2;
                ctx.beginPath();
                ctx.arc(this.x, this.y, size, 0, Math.PI * 2);
                ctx.fill();
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã«å°ã•ãªèƒå­ã‚’è¿½åŠ 
                if (Math.random() < 0.1) {
                    ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${alpha * 0.5})`;
                    ctx.beginPath();
                    ctx.arc(this.x + Math.random() * 4 - 2, this.y + Math.random() * 4 - 2, 1, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            grow() {
                this.age++;
                
                // ä¸€å®šã®å¹´é½¢ã«ãªã£ãŸã‚‰å‘¨å›²ã«åºƒãŒã‚‹
                if (this.age > 5 && !this.spread && Math.random() < 0.3) {
                    this.spread = true;
                    const newCells = [];
                    
                    // å‘¨å›²8æ–¹å‘ã«åºƒãŒã‚‹å¯èƒ½æ€§
                    for (let dx = -1; dx <= 1; dx++) {
                        for (let dy = -1; dy <= 1; dy++) {
                            if (dx === 0 && dy === 0) continue;
                            
                            if (Math.random() < 0.4) {
                                const newX = this.x + dx * (3 + Math.random() * 3);
                                const newY = this.y + dy * (3 + Math.random() * 3);
                                
                                // ã‚­ãƒ£ãƒ³ãƒã‚¹å†…ã‹ã¤ãƒ†ã‚­ã‚¹ãƒˆé ˜åŸŸã§ãªã„å ´åˆã®ã¿è¿½åŠ 
                                if (newX >= 0 && newX < canvas.width && 
                                    newY >= 0 && newY < canvas.height &&
                                    !isProtectedArea(newX, newY)) {
                                    newCells.push(new MoldCell(newX, newY));
                                }
                            }
                        }
                    }
                    
                    return newCells;
                }
                return [];
            }
        }
        
        function isProtectedArea(x, y) {
            const index = Math.floor(y) * canvas.width + Math.floor(x);
            return textMask[index] === 1;
        }
        
        function updateTextMask() {
            // ãƒã‚¹ã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆ
            textMask = new Array(canvas.width * canvas.height).fill(0);
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚’æç”»ã—ã¦ãƒã‚¹ã‚¯ã‚’ä½œæˆ
            ctx.save();
            ctx.fillStyle = 'black';
            ctx.font = 'bold 80px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            const textX = canvas.width / 2;
            const textY = canvas.height / 2;
            
            ctx.fillText(protectedText, textX, textY);
            
            // ãƒ”ã‚¯ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒã‚¹ã‚¯ã‚’ä½œæˆ
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const alpha = data[i + 3];
                if (alpha > 128) {
                    const pixelIndex = i / 4;
                    textMask[pixelIndex] = 1;
                }
            }
            
            ctx.restore();
        }
        
        function drawProtectedText() {
            ctx.save();
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.strokeStyle = 'rgba(100, 100, 100, 0.5)';
            ctx.lineWidth = 2;
            ctx.font = 'bold 80px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            const textX = canvas.width / 2;
            const textY = canvas.height / 2;
            
            ctx.strokeText(protectedText, textX, textY);
            ctx.fillText(protectedText, textX, textY);
            ctx.restore();
        }
        
        function animate() {
            if (!isRunning) return;
            
            // ã‚«ãƒ“ã®ã‚»ãƒ«ã‚’æç”»
            moldCells.forEach(cell => {
                cell.draw();
                const newCells = cell.grow();
                moldCells.push(...newCells);
            });
            
            // ä¿è­·ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’å†æç”»
            drawProtectedText();
            
            // å¤ã„ã‚»ãƒ«ã‚’å‰Šé™¤ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¯¾ç­–ï¼‰
            if (moldCells.length > 10000) {
                moldCells = moldCells.slice(-8000);
            }
            
            requestAnimationFrame(animate);
        }
        
        function reset() {
            ctx.fillStyle = '#f5f5dc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            moldCells = [];
            updateTextMask();
            drawProtectedText();
            
            // åˆæœŸèƒå­ã‚’é…ç½®
            for (let i = 0; i < 5; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                if (!isProtectedArea(x, y)) {
                    moldCells.push(new MoldCell(x, y));
                }
            }
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!isRunning) {
                isRunning = true;
                animate();
            }
        });
        
        document.getElementById('pauseBtn').addEventListener('click', () => {
            isRunning = false;
        });
        
        document.getElementById('resetBtn').addEventListener('click', reset);
        
        document.getElementById('updateTextBtn').addEventListener('click', () => {
            const input = document.getElementById('textInput');
            protectedText = input.value || 'SAFE ZONE';
            reset();
        });
        
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (!isProtectedArea(x, y)) {
                moldCells.push(new MoldCell(x, y));
            }
        });
        
        // åˆæœŸåŒ–
        reset();
    </script>
</body>
</html>
